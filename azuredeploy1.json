{
    "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "resourceGroups_name": {
            "type": "string",
            "defaultValue": "Learning"
        },
        "storageAccounts_storage_name": {
            "type": "string",
            "minLength": 3,
            "maxLength": 24,
            "defaultValue": "learningv2"
        },
        "deployment_environment": {
            "type": "string",
            "allowedValues": [ "dev", "uat", "prod" ]
        },
        "componentID_tag": {
            "type": "string"
        },
        "tenantID": {
            "type": "string"
        },
        "vaults_keyvaultName": {
            "type": "string"
        },
        "vaults_servicePrincipal_objectId": {
            "type": "string"
        },
        "location": {
            "type": "string",
            "defaultValue": "Central US"
        },
        "serverfarms_appServicePlanName": {
            "type": "string",
            "defaultValue": "exampleplan"
        },
        "sites_webAppName": {
            "type": "string",
            "metadata": {
                "description": "Base name of the resource such as web app name and app service plan "
            },
            "minLength": 2
        },
        "windowsFxVersion": {
            "type": "string",
            "defaultValue": "node|10.14.1",
            "metadata": {
                "description": "The Runtime stack of current web app"
            }
        },
        "components_appInsightsName": {
            "type": "string"
        },
        "appInsights_dataRetention": {
            "type": "int",
            "defaultValue": 30,
            "minValue": 30,
            "maxValue": 90
        },
        "appInsights_sku_name": {
            "type": "string",
            "defaultValue": "F1"
        },
        "appInsights_sku_tier": {
            "type": "string",
            "defaultValue": "Free"
        },
        "appInsights_sku_family": {
            "type": "string",
            "defaultValue": "F"
        },
        "appInsights_sku_size": {
            "type": "string",
            "defaultValue": "F1"
        },
        "appInsights_sku_capacity": {
            "type": "int",
            "defaultValue": 0
        },
        "actionGroupName": {
            "type": "string",
            "metadata": {
                "description": "Unique name (within the Resource Group) for the Action group."
            }
        },
        "actionGroupShortName": {
            "type": "string",
            "metadata": {
                "description": "Short name (maximum 12 characters) for the Action group."
            }
        },
        "alertsEmail": {
            "type": "string",
            "metadata": {
                "description": "Email address to send the alert notification"
            }
        },
        "smartdetectoralertrules_failure_anomalies_name": {
            "defaultValue": "failure anomalies",
            "type": "String"
        },
        "siteextensions_name": {
            "type": "string",
            "defaultValue": ""
        },
        "siteextensions_apiversion": {
            "type": "string"
        }
    },
    "variables": {
        "resourceGroupName": "[concat(parameters('resourceGroups_name'), parameters('deployment_environment'))]",
        "storageName": "[concat(parameters('storageAccounts_storage_name'), parameters('deployment_environment'))]",
        "envTag": "[if(equals(parameters('deployment_environment'), 'prod'), 'Production', 'Pre-Production')]",
        "componentIDTag": "[parameters('componentID_tag')]",
        "keyvaultName": "[parameters('vaults_keyvaultName')]",
        "webAppPortalName": "[concat(parameters('sites_webAppName'), uniqueString(subscription().subscriptionId))]",
        "storageAccount_redundancy": "[if(equals(parameters('deployment_environment'), 'prod'), 'Standard_GRS', 'Standard_LRS')]",
        "appInsightsName": "[concat(parameters('components_appInsightsName'),parameters('deployment_environment'))]",
        "actionGroupShortName": "[concat(parameters('actionGroupShortName'),parameters('deployment_environment'))]",
        "actionGroupName": "[concat(parameters('actionGroupName'),parameters('deployment_environment'))]",
        "alertRulesFailureAnomalies": "[concat(parameters('smartdetectoralertrules_failure_anomalies_name'),parameters('deployment_environment'))]"
    },
    "resources": [
        {
            "name": "[variables('resourceGroupName')]",
            "type": "Microsoft.Resources/resourceGroups",
            "apiVersion": "2019-03-01",
            "location": "[parameters('location')]",
            "tags": {},
            "properties": {
            }
        },
        {
            "name": "ResourcesDeployment",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-06-01",
            "resourceGroup": "[variables('resourceGroupName')]",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/resourceGroups/', variables('resourceGroupName'))]"
            ],
            "properties": {
                "templateLink": {
                    // "relativePath": "./link/azuredeploy1.json"
                    "uri":"https://raw.githubusercontent.com/Nikita-121/ARMTemplate/master/azuredeploy1.json"
                },
                "mode": "Incremental",
                "parameters": {
                    "storageName": {"value":"[variables('storageName')]"},
                    "componentIDTag": {"value":"[variables('componentIDTag')]"},
                    "tenantID": {"value":"[parameters('tenantID')]"},
                    "keyvaultName": {"value":"[variables('keyvaultName')]"},
                    "vaults_servicePrincipal_objectId":{"value": "[parameters('vaults_servicePrincipal_objectId')]"},
                    "location": {"value":"[parameters('location')]"},
                    "serverfarms_appServicePlanName":{"value": "[parameters('serverfarms_appServicePlanName')]"},
                    "webAppPortalName": {"value":"[variables('webAppPortalName')]"},
                    "windowsFxVersion": {"value":"[parameters('windowsFxVersion')]"},
                    "appInsightsName":{"value":"[variables('appInsightsName')]"},
                    "appInsights_dataRetention":{"value":"[parameters('appInsights_dataRetention')]"},
                    "appInsights_sku_name":{"value":"[parameters('appInsights_sku_name')]"},
                    "appInsights_sku_tier": {"value":"[parameters('appInsights_sku_tier')]"},
                    "appInsights_sku_family": {"value":"[parameters('appInsights_sku_family')]"},
                    "appInsights_sku_size": {"value":"[parameters('appInsights_sku_size')]"},
                    "appInsights_sku_capacity": {"value":"[parameters('appInsights_sku_capacity')]"},
                    "actionGroupName": {"value":"[variables('actionGroupName')]"},
                    "actionGroupShortName": {"value":"[variables('actionGroupShortName')]"},
                    "alertsEmail": {"value":"[parameters('alertsEmail')]"},
                    "alertRulesFailureAnomalies":{"value":"[variables('alertRulesFailureAnomalies')]"},
                    "siteextensions_name": {"value":"[parameters('siteextensions_name')]"},
                    "siteextensions_apiversion":{"value":"[parameters('siteextensions_apiversion')]"},
                    "envTag":{"value":"[variables('envTag')]"},
                    "storageAccount_redundancy": {"value":"[variables('storageAccount_redundancy')]"}
                }
            },
            "tags": {}
        }
    ]
}
